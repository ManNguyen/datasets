<div class="mol-facets">
  <div class="visible-parts">
    <h5 class="left">View Mode</h5>
    <span class="btn-group pull-right">
      <label class="btn btn-primary btn-xs" ng-model="radioModel" uib-btn-radio="'Map'" ui-sref="datasets.all.map" ui-sref-active="active">
        Map Only
      </label>
      <label class="btn btn-primary btn-xs" ng-model="radioModel" uib-btn-radio="'List'" ui-sref="datasets.all.list" ui-sref-active="active">
        List Only
      </label>
      <label class="btn btn-primary btn-xs" ng-model="radioModel" uib-btn-radio="'Both'" ui-sref="datasets.all.both" ui-sref-active="active">
        Both
      </label>
    </span>
  </div>
  <hr />
  <div class="selected-options">
    <div>
      <h5 class="left">
        Filters
        <span class="clear-all">
          <a href="#" ng-click="clear()" ng-show="badges.length" class="badge" >
            Clear all
            <i class="clickable fa fa-times"></i>
          </a>
        </span>
        <span class="dataset-count">Datasets: {{(rows | choiceFilter:choices:fields).length | number: 0}}</span>
      </h5>
    </div>
    <span ng-repeat="badge in badges">
      <a class="badge" href="#" ng-show="choices[badge.facet][badge.value]" ng-click="choices[badge.facet][badge.value] = false">
        {{badge.title}}
        <i class="pull-right fa fa-times unselect"></i>
      </a>
    </span>
    <span class="nothing-selected" ng-show="!badges.length">Select items to filter below</span>
  </div>
  <div ng-repeat="field in fields | filter: {facet: true} track by $index" is-open="status.open">
    <hr />
    <div>
      <i ng-click="c = !c" class="pull-right clickable fa" ng-class="{'fa-caret-down': !c, 'fa-caret-left': c}"></i>
      <i class="pull-right clickable fa fa-times unselect-all"
        ng-show="facetBadges[field.value].length" ng-click="choices[field.value] = {}">
      </i>
      <h5 class="left">{{field.title}}</h5>
    </div>
    <div class="col-xs-offset-1" uib-collapse="c"
        ng-repeat="(value, group) in options = (rows | choiceFilter:choices:fields:field.value
                | map: getColumn($index) | flatten:shallow | orderBy:'sortby' | groupBy:'value')">
      <label class="clickable ng-binding" ng-show="!choices[field.value][value]">
        <input type="checkbox" ng-model="choices[field.value][value]"
            class="ng-valid ng-not-empty ng-dirty ng-valid-parse ng-touched hidden" />
        {{group[0].title}}&nbsp;
        <span ng-bind-html="'(' + group.length + ')'" class="ng-binding"></span>
      </label>
    </div>
    <label class="col-xs-offset-1" uib-collapse="c"
        ng-show="options | flatten:shallow | map: getColumn('value') | unique | excludeSelected:field:choices | isEmpty">
      No remaining options
    </label>
  </div>
</div>
